# Render manifest template for this repository.
# Before using: replace `repo: <YOUR_REPO>` with your repository URL (or let Render infer it when you connect the repo).
# This manifest creates a managed Postgres database, builds the frontend, and runs the backend
# which will also serve the frontend build (so existing relative `/api/*` calls continue to work).

services:
  - type: postgres
    name: panda-db
    plan: starter

  - type: web_service
    name: panda-backend
    env: node
    plan: free
    # Build frontend then install backend dependencies at build time
    buildCommand: "npm --prefix frontend ci && npm --prefix frontend run build && npm --prefix backend ci"
    startCommand: "npm --prefix backend start"
    # Let Render inject DB connection vars from the postgres service above
    envVars:
      - key: NODE_ENV
        value: production
      - key: PGHOST
        fromDatabase:
          name: panda-db
          property: host
      - key: PGPORT
        fromDatabase:
          name: panda-db
          property: port
      - key: PGDATABASE
        fromDatabase:
          name: panda-db
          property: database
      - key: PGUSER
        fromDatabase:
          name: panda-db
          property: user
      - key: PGPASSWORD
        fromDatabase:
          name: panda-db
          property: password

  - type: static_site
    name: panda-frontend
    plan: free
    # If you prefer using a separate static site: build command and published directory
    buildCommand: "npm --prefix frontend ci && npm --prefix frontend run build"
    publishPath: "frontend/build"

# Notes:
# - This manifest is a template. When you connect your GitHub repo in Render you can
#   either use this manifest or create services manually in the Render dashboard.
# - The manifest sets up both a web service that runs the backend and a static site
#   that can serve the frontend. If you want a single service (backend serving the
#   frontend build) you can skip creating the separate static_site in the dashboard
#   or remove the static_site block above.